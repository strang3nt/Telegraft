<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="778.5px" preserveAspectRatio="none" style="width:1146px;height:778px;background:#FFFFFF;" version="1.1" viewBox="0 0 1146 778" width="1146.6px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="759.6563" style="stroke:#181818;stroke-width:1.35;" width="1120.5" x="20.7" y="13.5"/><path d="M128.7,13.5 L128.7,23.959 L119.7,32.959 L20.7,32.959 " fill="none" style="stroke:#181818;stroke-width:1.35;"/><text fill="#000000" font-family="sans-serif" font-size="12.6" font-weight="bold" lengthAdjust="spacing" textLength="15.3" x="23.4" y="27.9967">cd</text><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="80.1" x="42.3" y="27.9967">ClientRequest</text><rect fill="none" height="122.5477" style="stroke:#000000;stroke-width:1.35;" width="409.95" x="618.75" y="248.1627"/><rect fill="none" height="346.9869" style="stroke:#000000;stroke-width:1.35;" width="1099.8" x="26.1" y="386.9104"/><rect fill="none" height="66.2238" style="stroke:#000000;stroke-width:1.35;" width="361.35" x="618.75" y="626.9115"/><line style="stroke:#181818;stroke-width:0.9;" x1="204.3" x2="204.3" y1="140.8799" y2="584.9438"/><polygon fill="#181818" points="200.7,149.8799,204.3,140.8799,207.9,149.8799,204.3,146.2799" style="stroke:#181818;stroke-width:0.9;"/><polygon fill="#181818" points="200.7,575.9438,204.3,584.9438,207.9,575.9438,204.3,579.5438" style="stroke:#181818;stroke-width:0.9;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="63.9" x="207.9" y="367.7563">less than 3s</text><line style="stroke:#181818;stroke-width:0.45;stroke-dasharray:5.0,5.0;" x1="76.5" x2="76.5" y1="110.918" y2="755.4973"/><rect fill="#FFFFFF" height="620.2793" style="stroke:#181818;stroke-width:0.9;" width="9" x="72" y="118.118"/><line style="stroke:#181818;stroke-width:0.45;stroke-dasharray:5.0,5.0;" x1="332.1" x2="332.1" y1="110.918" y2="755.4973"/><rect fill="#FFFFFF" height="447.6639" style="stroke:#181818;stroke-width:0.9;" width="9" x="327.6" y="139.0799"/><line style="stroke:#181818;stroke-width:0.45;stroke-dasharray:5.0,5.0;" x1="505.8" x2="505.8" y1="146.2799" y2="755.4973"/><rect fill="#FFFFFF" height="391.34" style="stroke:#181818;stroke-width:0.9;" width="9" x="501.3" y="167.2418"/><line style="stroke:#181818;stroke-width:0.45;stroke-dasharray:5.0,5.0;" x1="761.4" x2="761.4" y1="110.918" y2="755.4973"/><rect fill="#FFFFFF" height="557.9965" style="stroke:#181818;stroke-width:0.9;" width="9" x="756.9" y="197.5008"/><rect fill="#FFFFFF" height="293.0572" style="stroke:#181818;stroke-width:0.9;" width="9" x="761.4" y="237.3627"/><rect fill="#FFFFFF" height="69.5619" style="stroke:#181818;stroke-width:0.9;" width="9" x="761.4" y="685.9354"/><rect fill="#FFFFFF" height="77.2857" style="stroke:#181818;stroke-width:0.9;" width="9" x="765.9" y="274.5246"/><rect fill="#FFFFFF" height="77.2857" style="stroke:#181818;stroke-width:0.9;" width="9" x="765.9" y="413.2723"/><line style="stroke:#181818;stroke-width:0.45;stroke-dasharray:5.0,5.0;" x1="965.7" x2="965.7" y1="110.918" y2="755.4973"/><rect fill="#FFFFFF" height="28.1619" style="stroke:#181818;stroke-width:0.9;" width="9" x="961.2" y="295.4865"/><line style="stroke:#181818;stroke-width:0.45;stroke-dasharray:5.0,5.0;" x1="1067.4" x2="1067.4" y1="110.918" y2="755.4973"/><rect fill="#FFFFFF" height="28.1619" style="stroke:#181818;stroke-width:0.9;" width="9" x="1062.9" y="434.2342"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="66.6" x="40.5" y="107.7557">gRPC client</text><ellipse cx="76.5" cy="47.809" fill="#E2E2F0" rx="7.2" ry="7.2" style="stroke:#181818;stroke-width:0.45;"/><path d="M76.5,55.009 L76.5,79.309 M64.8,62.209 L88.2,62.209 M76.5,79.309 L64.8,92.809 M76.5,79.309 L88.2,92.809 " fill="none" style="stroke:#181818;stroke-width:0.45;"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="124.2" x="267.3" y="107.7557">:RaftClientServiceImpl</text><path d="M313.65,68.959 L313.65,90.559 M313.65,79.759 L328.95,79.759 " fill="none" style="stroke:#181818;stroke-width:0.45;"/><ellipse cx="339.75" cy="79.759" fill="#E2E2F0" rx="10.8" ry="10.8" style="stroke:#181818;stroke-width:0.45;"/><rect fill="#E2E2F0" height="29.359" rx="2.25" ry="2.25" style="stroke:#181818;stroke-width:0.45;" width="256.5" x="633.15" y="80.659"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="243.9" x="639.45" y="100.5557">raftServer :Behavior[RaftServer.Command]</text><rect fill="#E2E2F0" height="29.359" style="stroke:#181818;stroke-width:0.45;" width="93.6" x="920.7" y="77.059"/><rect fill="#E2E2F0" height="29.359" style="stroke:#181818;stroke-width:0.45;" width="93.6" x="917.1" y="80.659"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="81" x="923.4" y="100.5557">server: Server</text><rect fill="#E2E2F0" height="29.359" rx="2.25" ry="2.25" style="stroke:#181818;stroke-width:0.45;" width="88.2" x="1023.3" y="80.659"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="75.6" x="1029.6" y="100.5557">stateMachine</text><polygon fill="#181818" points="316.8,135.4799,325.8,139.0799,316.8,142.6799" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;" x1="81" x2="322.2" y1="139.0799" y2="139.0799"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="87.3" y="134.3435">1</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="219.6" x="97.2" y="134.3435">ClientRequest(clientId, requestId, payload)</text><rect fill="#E2E2F0" height="29.359" rx="2.25" ry="2.25" style="stroke:#181818;stroke-width:0.45;" width="196.2" x="403.2" y="146.2799"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="183.6" x="409.5" y="166.1766">:Behavior[RaftServer.Command]</text><polygon fill="#181818" points="392.4,163.6418,401.4,167.2418,392.4,170.8418" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;" x1="336.6" x2="397.8" y1="167.2418" y2="167.2418"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="342.9" y="162.5054">2</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="39.6" x="352.8" y="162.5054">spawns</text><polygon fill="#181818" points="746.1,193.9008,755.1,197.5008,746.1,201.1008" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;" x1="510.3" x2="751.5" y1="197.5008" y2="197.5008"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="516.6" y="192.7644">3</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="219.6" x="526.5" y="192.7644">ClientRequest(clientId, requestId, payload)</text><line style="stroke:#181818;stroke-width:0.9;" x1="765.9" x2="808.2" y1="225.6627" y2="225.6627"/><line style="stroke:#181818;stroke-width:0.9;" x1="808.2" x2="808.2" y1="225.6627" y2="237.3627"/><line style="stroke:#181818;stroke-width:0.9;" x1="771.3" x2="808.2" y1="237.3627" y2="237.3627"/><polygon fill="#181818" points="780.3,233.7627,771.3,237.3627,780.3,240.9627" style="stroke:#181818;stroke-width:0.9;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="776.7" y="220.9263">4</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="162" x="786.6" y="220.9263">ApplyToStateMachine(payload)</text><path d="M618.75,248.1627 L684.45,248.1627 L684.45,256.5246 L675.45,265.5246 L618.75,265.5246 L618.75,248.1627 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.35;"/><rect fill="none" height="122.5477" style="stroke:#000000;stroke-width:1.35;" width="409.95" x="618.75" y="248.1627"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="25.2" x="632.25" y="261.6882">loop</text><text fill="#000000" font-family="sans-serif" font-size="9.9" font-weight="bold" lengthAdjust="spacing" textLength="128.7" x="697.95" y="260.6458">[for each server in config]</text><polygon fill="#181818" points="950.4,291.8865,959.4,295.4865,950.4,299.0865" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;" x1="774.9" x2="955.8" y1="295.4865" y2="295.4865"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="781.2" y="290.7501">5</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="167.4" x="791.1" y="290.7501">AppendEntriesRequest(payload)</text><polygon fill="#181818" points="784.8,320.0484,775.8,323.6484,784.8,327.2484" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="779.4" x2="960.3" y1="323.6484" y2="323.6484"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="809.1" y="318.912">6</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="135.9" x="819" y="318.912">AppendEntriesResponse()</text><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="774.9" x2="812.7" y1="351.8104" y2="351.8104"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="812.7" x2="812.7" y1="351.8104" y2="363.5104"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="770.4" x2="812.7" y1="363.5104" y2="363.5104"/><polygon fill="#181818" points="779.4,359.9104,770.4,363.5104,779.4,367.1104" style="stroke:#181818;stroke-width:0.9;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="781.2" y="347.0739">7</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="128.7" x="791.1" y="347.0739">AppendEntriesResponse</text><path d="M26.1,386.9104 L81,386.9104 L81,395.2723 L72,404.2723 L26.1,404.2723 L26.1,386.9104 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.35;"/><rect fill="none" height="346.9869" style="stroke:#000000;stroke-width:1.35;" width="1099.8" x="26.1" y="386.9104"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="14.4" x="39.6" y="400.4358">alt</text><text fill="#000000" font-family="sans-serif" font-size="9.9" font-weight="bold" lengthAdjust="spacing" textLength="162.9" x="94.5" y="399.3935">[if payload is ready to be applied]</text><line style="stroke:#000000;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="26.1" x2="1125.9" y1="603.8438" y2="603.8438"/><text fill="#000000" font-family="sans-serif" font-size="9.9" font-weight="bold" lengthAdjust="spacing" textLength="161.1" x="30.6" y="616.3269">[payload not ready to be applied]</text><polygon fill="#181818" points="1052.1,430.6342,1061.1,434.2342,1052.1,437.8342" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;" x1="774.9" x2="1057.5" y1="434.2342" y2="434.2342"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="781.2" y="429.4978">8</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="71.1" x="791.1" y="429.4978">Send payload</text><polygon fill="#181818" points="784.8,458.7961,775.8,462.3961,784.8,465.9961" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="779.4" x2="1062" y1="462.3961" y2="462.3961"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="6.3" x="994.5" y="457.6597">9</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="52.2" x="1004.4" y="457.6597">Response</text><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="774.9" x2="812.7" y1="490.558" y2="490.558"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="812.7" x2="812.7" y1="490.558" y2="502.258"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="770.4" x2="812.7" y1="502.258" y2="502.258"/><polygon fill="#181818" points="779.4,498.658,770.4,502.258,779.4,505.858" style="stroke:#181818;stroke-width:0.9;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="12.6" x="781.2" y="485.8216">10</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="52.2" x="797.4" y="485.8216">Response</text><polygon fill="#181818" points="520.2,526.8199,511.2,530.4199,520.2,534.0199" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="514.8" x2="756" y1="530.4199" y2="530.4199"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="12.6" x="682.2" y="525.6835">11</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="52.2" x="698.4" y="525.6835">Response</text><polygon fill="#181818" points="346.5,554.9818,337.5,558.5818,346.5,562.1818" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="341.1" x2="500.4" y1="558.5818" y2="558.5818"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="12.6" x="426.6" y="553.8454">12</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="52.2" x="442.8" y="553.8454">Response</text><polygon fill="#181818" points="90.9,583.1438,81.9,586.7438,90.9,590.3438" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="85.5" x2="326.7" y1="586.7438" y2="586.7438"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="12.6" x="252.9" y="582.0073">13</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="52.2" x="269.1" y="582.0073">Response</text><path d="M618.75,626.9115 L684.45,626.9115 L684.45,635.2734 L675.45,644.2734 L618.75,644.2734 L618.75,626.9115 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.35;"/><rect fill="none" height="66.2238" style="stroke:#000000;stroke-width:1.35;" width="361.35" x="618.75" y="626.9115"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="25.2" x="632.25" y="640.437">loop</text><text fill="#000000" font-family="sans-serif" font-size="9.9" font-weight="bold" lengthAdjust="spacing" textLength="177.3" x="697.95" y="639.3946">[until it can be applied or discarded]</text><line style="stroke:#181818;stroke-width:0.9;" x1="765.9" x2="808.2" y1="674.2354" y2="674.2354"/><line style="stroke:#181818;stroke-width:0.9;" x1="808.2" x2="808.2" y1="674.2354" y2="685.9354"/><line style="stroke:#181818;stroke-width:0.9;" x1="771.3" x2="808.2" y1="685.9354" y2="685.9354"/><polygon fill="#181818" points="780.3,682.3354,771.3,685.9354,780.3,689.5354" style="stroke:#181818;stroke-width:0.9;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="12.6" x="776.7" y="669.4989">14</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="162" x="792.9" y="669.4989">ApplyToStateMachine(payload)</text><polygon fill="#181818" points="90.9,723.0973,81.9,726.6973,90.9,730.2973" style="stroke:#181818;stroke-width:0.9;"/><line style="stroke:#181818;stroke-width:0.9;stroke-dasharray:2.0,2.0;" x1="85.5" x2="331.2" y1="726.6973" y2="726.6973"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacing" textLength="12.6" x="223.2" y="721.9608">15</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="86.4" x="239.4" y="721.9608">Failure response</text><line style="stroke:#181818;stroke-width:0.9;" x1="204.3" x2="204.3" y1="140.8799" y2="584.9438"/><polygon fill="#181818" points="200.7,149.8799,204.3,140.8799,207.9,149.8799,204.3,146.2799" style="stroke:#181818;stroke-width:0.9;"/><polygon fill="#181818" points="200.7,575.9438,204.3,584.9438,207.9,575.9438,204.3,579.5438" style="stroke:#181818;stroke-width:0.9;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacing" textLength="63.9" x="207.9" y="367.7563">less than 3s</text><!--MD5=[83da3cbd3992efd28db1dcf6699ab296]
@startuml sd_clientRequest

mainframe **cd** ClientRequest

skinparam style strictuml
autoactivate on
autonumber

!pragma teoz true
skinparam sequenceMessageAlign direction

actor "gRPC client" as Client

boundary ":RaftClientServiceImpl" as RaftClientServiceImpl

participant ":Behavior[RaftServer.Command]" as TempActor

activate Client
{time_start} Client -> RaftClientServiceImpl: ClientRequest(clientId, requestId, payload)

RaftClientServiceImpl -> TempActor **: spawns
activate TempActor

participant "raftServer :Behavior[RaftServer.Command]" as raftServer

TempActor -> raftServer: ClientRequest(clientId, requestId, payload)

raftServer -> raftServer: ApplyToStateMachine(payload)

collections "server: Server" as server

loop for each server in config

  activate raftServer
  raftServer -> server: AppendEntriesRequest(payload)
  raftServer <- - server: AppendEntriesResponse()
  return AppendEntriesResponse



end



alt if payload is ready to be applied
  activate raftServer
  raftServer -> stateMachine: Send payload
  raftServer <- - stateMachine: Response
  return Response

  raftServer - -> TempActor: Response
  RaftClientServiceImpl <- - TempActor: Response
  {time_end} RaftClientServiceImpl - -> Client: Response
  {time_end} <-> {time_start} : less than 3s

else payload not ready to be applied
  loop until it can be applied or discarded
    raftServer -> raftServer: ApplyToStateMachine(payload)
  end
  RaftClientServiceImpl - -> Client: Failure response
  deactivate Client
end



@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: it
Country: IT
--></g></svg>